<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClientNova Labs CRM</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; margin:0; background:#e6f2e6; padding:20px; }
header { display:flex; align-items:center; margin-bottom:20px; }
header img { height:60px; margin-right:15px; }
header h1 { color:#2a4d69; }
nav { background:#fff; display:flex; gap:10px; padding:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
nav button { border:none; background:#2a4d69; color:white; padding:10px 15px; cursor:pointer; border-radius:4px; }
section { padding:20px; display:none; }
.active { display:block; }
table { width:100%; border-collapse: collapse; background:white; margin-top:15px; }
th, td { border:1px solid #ccc; padding:8px; text-align:left; }
th { background:#2a4d69; color:white; }
select, textarea, button, input { padding:5px; margin:2px; }
button { background:#2a4d69; color:white; border:none; cursor:pointer; border-radius:4px; }
.products { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:15px; margin-top:15px; }
.product-card { background:white; border-radius:8px; padding:15px; box-shadow:0 1px 6px rgba(0,0,0,0.1); }
.product-card h3 { margin:0; color:#2a4d69; }
</style>
</head>
<body>

<header>
    <img src="https://i.postimg.cc/CzJswC7w/59e68286.png" alt="Logo">
    <h1>ClientNova Labs CRM</h1>
</header>

<nav>
    <button onclick="showSection('publicView')">Public View</button>
    <button onclick="showSection('staffView')">Staff Updates</button>
</nav>

<!-- PUBLIC VIEW -->
<section id="publicView" class="active">
    <h2>Open Leads</h2>
    <table id="openLeadsTable">
        <thead>
            <tr>
                <th>Name</th><th>Email</th><th>Phone</th><th>Company</th>
                <th>Product</th><th>Lead Source</th><th>Value (â‚¬)</th><th>Status</th><th>Updated By</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Closed Leads</h2>
    <table id="closedLeadsTable">
        <thead>
            <tr>
                <th>Name</th><th>Email</th><th>Company</th><th>Product</th><th>Status</th><th>Updated By</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<!-- STAFF VIEW -->
<section id="staffView">
    <h2>My Leads</h2>
    <table id="staffLeadsTable">
        <thead>
            <tr>
                <th>Lead Name</th><th>Email</th><th>Company</th>
                <th>Product</th><th>Status</th><th>Update Status</th>
                <th>Notes</th><th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<script>
// Navigation
function showSection(id){
    document.querySelectorAll("section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

// Firebase config (updated)
const firebaseConfig = {
  apiKey: "AIzaSyAgV5ML9wBhikQNni5cetnjYSwsgG1nIww",
  authDomain: "crm-sales-pipeline---public.firebaseapp.com",
  projectId: "crm-sales-pipeline---public",
  storageBucket: "crm-sales-pipeline---public.firebasestorage.app",
  messagingSenderId: "515554005522",
  appId: "1:515554005522:web:db788425693fa9874e3ecb",
  measurementId: "G-4S6Z3RZFQC"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Staff member (for demo, replace with auth later)
const currentStaff = "Alice Smith";

// Tables
const openLeadsTable = document.getElementById("openLeadsTable").querySelector("tbody");
const closedLeadsTable = document.getElementById("closedLeadsTable").querySelector("tbody");
const staffTable = document.getElementById("staffLeadsTable").querySelector("tbody");

// Real-time sync
db.collection("leads").orderBy("updatedAt","desc").onSnapshot(snapshot=>{
    openLeadsTable.innerHTML="";
    closedLeadsTable.innerHTML="";
    staffTable.innerHTML="";

    snapshot.forEach(doc=>{
        const lead = doc.data();
        const rowOpen = document.createElement("tr");
        const rowClosed = document.createElement("tr");
        const rowStaff = document.createElement("tr");

        // Public Open/Closed Leads
        if(lead.status==="Won"||lead.status==="Lost"){
            rowClosed.innerHTML=`
                <td>${lead.leadName}</td>
                <td>${lead.email}</td>
                <td>${lead.company}</td>
                <td>${lead.productInterest}</td>
                <td>${lead.status}</td>
                <td>${lead.updatedBy || ""}</td>
            `;
            closedLeadsTable.appendChild(rowClosed);
        }else{
            rowOpen.innerHTML=`
                <td>${lead.leadName}</td>
                <td>${lead.email}</td>
                <td>${lead.phone}</td>
                <td>${lead.company}</td>
                <td>${lead.productInterest}</td>
                <td>${lead.leadSource}</td>
                <td>${lead.estimatedValue}</td>
                <td>${lead.status}</td>
                <td>${lead.updatedBy || ""}</td>
            `;
            openLeadsTable.appendChild(rowOpen);
        }

        // Staff view (only assigned leads)
        if(lead.assignedTo===currentStaff){
            rowStaff.innerHTML=`
                <td>${lead.leadName}</td>
                <td>${lead.email}</td>
                <td>${lead.company}</td>
                <td>${lead.productInterest}</td>
                <td>${lead.status}</td>
                <td>
                    <select id="status-${doc.id}">
                        <option value="New" ${lead.status=="New"?"selected":""}>New</option>
                        <option value="Contacted" ${lead.status=="Contacted"?"selected":""}>Contacted</option>
                        <option value="Qualified" ${lead.status=="Qualified"?"selected":""}>Qualified</option>
                        <option value="Opportunity" ${lead.status=="Opportunity"?"selected":""}>Opportunity</option>
                        <option value="Quote Created" ${lead.status=="Quote Created"?"selected":""}>Quote Created</option>
                        <option value="Customer PO in Process" ${lead.status=="Customer PO in Process"?"selected":""}>Customer PO in Process</option>
                        <option value="Won" ${lead.status=="Won"?"selected":""}>Won</option>
                        <option value="Lost" ${lead.status=="Lost"?"selected":""}>Lost</option>
                    </select>
                </td>
                <td><textarea id="notes-${doc.id}" rows="1">${lead.notes||""}</textarea></td>
                <td><button onclick="updateLead('${doc.id}')">Update</button></td>
            `;
            staffTable.appendChild(rowStaff);
        }
    });
});

// Update lead with "Updated By"
function updateLead(id){
    const newStatus = document.getElementById(`status-${id}`).value;
    const newNotes = document.getElementById(`notes-${id}`).value;

    db.collection("leads").doc(id).update({
        status: newStatus,
        notes: newNotes,
        updatedBy: currentStaff,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(()=>alert("Lead updated successfully"))
      .catch(err=>console.error(err));
}
</script>

</body>
</html>
